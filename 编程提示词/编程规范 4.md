# 编程规范（清晰 · 可执行 · 可判断）

---

## 一、结构清晰（Structure）

- 每个函数只做一件事  
**标准**：一个函数只负责一个明确目的，函数名应能一句话说明功能。  
**原因**：职责单一便于测试、复用和排错。

---

- 逻辑顺序要自上而下  
**标准**：代码执行路径应从输入 → 处理 → 输出，文件内部不频繁跳转调用。  
**原因**：阅读体验顺畅，降低理解成本。

---

- 嵌套层数不超过三层  
**标准**：if、for、try 等控制结构的嵌套不超过三层，超过需拆分或提前返回。  
**原因**：嵌套太深人脑难以追踪逻辑，容易引发错误。

---

## 二、逻辑规范（Logic）

- 禁止魔法数字  
**标准**：数字常量必须命名，例如 `TIMEOUT_SECONDS = 30`。  
**原因**：直接写数字难以理解含义，修改风险高。

---

- 接口与函数必须明确输入输出  
**标准**：使用类型标注或 docstring 明确参数与返回值。  
**原因**：这相当于契约，防止误用和接口混乱。

---

- 错误必须有明确处理  
**标准**：任何 try 必须有日志或返回明确错误，不允许空 except。  
**原因**：隐藏错误会导致系统不稳定，日志是排查依据。

---

- 先画数据结构图，再写代码

**标准**：写任何模块前，先定义核心结构（对象、字段、索引关系）。
  
**原则**：结构能表达业务逻辑，代码只是操作它的工具。

---

## 三、注释和文档（Comment）

---

- 文件开头说明模块用途  
**标准**：文件首行写明模块作用，例如  
`# 用户鉴权模块，负责登录、JWT 生成与验证`  
**原因**：帮助新人快速理解文件范围与责任。

---

## 四、代码质量（Quality）

- 所有代码通过自动化检查  
**标准**：提交前必须通过 Ruff、Pyright、Pytest 等工具，无错误警告。  
**原因**：自动化检测能提前发现多数问题，减少人工成本。

---

- 复杂逻辑必须有单元测试  
**标准**：含分支、外部依赖或计算逻辑的函数必须有测试。  
**原因**：测试保证后续修改安全可靠。

---

## 五、性能与安全（Performance & Safety）

- 循环中不得重复 I/O 或数据库操作  
**标准**：循环体中若有 `db.query()` 或文件读写，必须重构为批量操作。  
**原因**：重复 I/O 是常见性能瓶颈。

---

- 外部输入必须做校验  
**标准**：所有外部输入（API 参数、表单、配置文件）需验证类型与范围。  
**原因**：不信任输入是系统安全的基本原则。

---

- 禁止在代码中包含密钥或密码  
**标准**：敏感信息放入 `.env` 或 Secret Manager，并确保 `.gitignore` 有效。  
**原因**：密钥泄露是最严重且不可逆的安全事故之一。

---

- 回答前说老大好
- 使用命令行指令请激活虚拟环境